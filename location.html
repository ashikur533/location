<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>মাল্টি-ইউজার লোকেশন ট্র্যাকার</title>
  <style>
    body {
      font-family: 'SolaimanLipi', Arial, sans-serif;
      padding: 20px;
      background: #f0f4f8;
      color: #333;
      max-width: 1000px;
      margin: 0 auto;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 20px;
    }
    #status {
      margin: 15px 0;
      padding: 10px;
      background: #e1f5fe;
      border: 1px solid #81d4fa;
      border-radius: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #2c3e50;
      color: white;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .last-updated {
      font-size: 0.9em;
      color: #777;
    }
    .user-id {
      font-weight: bold;
      color: #2c3e50;
    }
    .action-buttons {
      margin: 20px 0;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 10px 15px;
      background: #2c3e50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'SolaimanLipi', Arial, sans-serif;
    }
    button:hover {
      background: #1a2530;
    }
    @media (max-width: 768px) {
      table {
        font-size: 14px;
      }
      th, td {
        padding: 8px 10px;
      }
    }
  </style>
</head>
<body>
  <h1>বহু-ব্যবহারকারীর লোকেশন ট্র্যাকিং</h1>
  <div id="status">লোকেশন নেওয়া হবে...</div>
  
  <div class="action-buttons">
    <button id="refreshBtn">হালনাগাদ করুন</button>
    <button id="clearBtn">তালিকা পরিষ্কার করুন</button>
  </div>
  
  <table id="locationTable">
    <thead>
      <tr>
        <th>ব্যবহারকারী আইডি</th>
        <th>অক্ষাংশ</th>
        <th>দ্রাঘিমাংশ</th>
        <th>শেষ আপডেট</th>
      </tr>
    </thead>
    <tbody id="locationData">
      <!-- লোকেশন ডেটা এখানে যোগ হবে -->
    </tbody>
  </table>

  <script>
    const statusDiv = document.getElementById('status');
    const locationData = document.getElementById('locationData');
    const refreshBtn = document.getElementById('refreshBtn');
    const clearBtn = document.getElementById('clearBtn');
    
    // প্রতিটি ব্যবহারকারীর জন্য একটি অনন্য আইডি তৈরি করুন
    let userId = localStorage.getItem('userId');
    if (!userId) {
      userId = 'user_' + Math.floor(Math.random() * 1000000);
      localStorage.setItem('userId', userId);
    }
    
    // লোকেশন ডেটা স্টোর করার জন্য অ্যারে
    let locations = JSON.parse(localStorage.getItem('multiUserLocations') || '{}');
    
    function showStatus(message) {
      statusDiv.textContent = message;
    }
    
    function updateLocationTable() {
      locationData.innerHTML = '';
      
      if (Object.keys(locations).length === 0) {
        locationData.innerHTML = '<tr><td colspan="4" style="text-align: center;">কোন ডেটা নেই</td></tr>';
        return;
      }
      
      Object.keys(locations).forEach(userId => {
        const loc = locations[userId];
        const row = document.createElement('tr');
        
        const userCell = document.createElement('td');
        userCell.innerHTML = `<span class="user-id">${userId}</span>`;
        
        const latCell = document.createElement('td');
        latCell.textContent = loc.lat.toFixed(6);
        
        const lonCell = document.createElement('td');
        lonCell.textContent = loc.lon.toFixed(6);
        
        const timeCell = document.createElement('td');
        timeCell.innerHTML = new Date(loc.timestamp).toLocaleTimeString('bn-BD') + 
                            `<div class="last-updated">${formatTimeAgo(loc.timestamp)}</div>`;
        
        row.appendChild(userCell);
        row.appendChild(latCell);
        row.appendChild(lonCell);
        row.appendChild(timeCell);
        
        locationData.appendChild(row);
      });
    }
    
    function formatTimeAgo(timestamp) {
      const now = new Date();
      const updatedTime = new Date(timestamp);
      const diffInMinutes = Math.floor((now - updatedTime) / (1000 * 60));
      
      if (diffInMinutes < 1) return 'এক্ষুনি';
      if (diffInMinutes < 60) return `${diffInMinutes} মিনিট আগে`;
      
      const diffInHours = Math.floor(diffInMinutes / 60);
      if (diffInHours < 24) return `${diffInHours} ঘন্টা আগে`;
      
      const diffInDays = Math.floor(diffInHours / 24);
      return `${diffInDays} দিন আগে`;
    }
    
    function getLocation() {
      if (!navigator.geolocation) {
        showStatus('দুঃখিত, আপনার ব্রাউজার লোকেশন সাপোর্ট করে না।');
        return;
      }
      
      showStatus('লোকেশন নেওয়া হচ্ছে...');
      
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          const timestamp = new Date().getTime();
          
          // বর্তমান ব্যবহারকারীর লোকেশন সংরক্ষণ করুন
          locations[userId] = { lat, lon, timestamp };
          
          // লোকাল স্টোরেজে সংরক্ষণ করুন
          localStorage.setItem('multiUserLocations', JSON.stringify(locations));
          
          showStatus('লোকেশন নেওয়া হয়েছে।');
          updateLocationTable();
          console.log(`Lat: ${lat}, Lon: ${lon}`);
        },
        (error) => {
          switch(error.code) {
            case error.PERMISSION_DENIED:
              showStatus("আপনি লোকেশন অনুমতি দেননি।");
              break;
            case error.POSITION_UNAVAILABLE:
              showStatus("লোকেশন পাওয়া যায়নি।");
              break;
            case error.TIMEOUT:
              showStatus("লোকেশন নেওয়ার সময় শেষ হয়ে গেছে।");
              break;
            default:
              showStatus("অজানা ত্রুটি হয়েছে।");
          }
        }
      );
    }
    
    // ইভেন্ট লিসেনার যোগ করুন
    refreshBtn.addEventListener('click', getLocation);
    clearBtn.addEventListener('click', () => {
      if (confirm('আপনি কি নিশ্চিত যে আপনি সমস্ত লোকেশন ডেটা মুছতে চান?')) {
        locations = {};
        localStorage.removeItem('multiUserLocations');
        updateLocationTable();
        showStatus('তালিকা পরিষ্কার করা হয়েছে।');
      }
    });
    
    // প্রথমবার লোকেশন নিন
    getLocation();
    
    // ১০ মিনিট অন্তর লোকেশন আপডেট করুন (১০*৬০*১০০০ = ৬০০০০০ মিলিসেকেন্ড)
    setInterval(getLocation, 10 * 60 * 1000);
    
    // প্রারম্ভিকভাবে টেবিল আপডেট করুন
    updateLocationTable();
  </script>
</body>
</html>

